<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë§µë§µë§µ - ë§¤ìš´ë§› ì‹¤íŒ¨ ì—†ëŠ” ë§›ì§‘ ì§€ë„</title>

  <!-- Kakao Maps -->
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=80397851cbdcec5a798a9cd405203780&libraries=services"></script>
  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: #f5f5f5;
      min-height: 100vh;
    }

    /* ========== í—¤ë” ========== */
    .header {
      background: white;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 10000;
    }

    .header-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      font-size: 0px;
      font-weight: 900;
      color: #c5171e;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .user-info .nickname {
      font-weight: 600;
      color: #333;
    }

    .user-level-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 700;
    }

    .level-0 {
      background: #f0f0f0;
      color: #666;
    }

    .level-1 {
      background: #e8f5e9;
      color: #2e7d32;
    }

    .level-2 {
      background: #fff3e0;
      color: #ef6c00;
    }

    .level-3 {
      background: #ffebee;
      color: #c62828;
    }

    .level-4 {
      background: #fce4ec;
      color: #ad1457;
    }

    .level-5 {
      background: #4a0000;
      color: #fff;
    }

    /* ========== ì˜¨ë³´ë”© ========== */
    #onboarding {
      min-height: calc(100vh - 80px);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
      background: linear-gradient(135deg, #c5171e 0%, #ff6b35 100%);
    }

    .onboarding-container {
      background: white;
      border-radius: 24px;
      padding: 40px 30px;
      max-width: 450px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .onboarding-logo {
      text-align: center;
      margin-bottom: 30px;
    }

    .onboarding-logo h1 {
      font-size: 0px;
      font-weight: 900;
      color: #c5171e;
      margin-bottom: 8px;
    }

    .onboarding-logo p {
      color: #666;
      font-size: 14px;
    }

    .form-group {
      margin-bottom: 24px;
    }

    .form-group label {
      display: block;
      font-weight: 700;
      margin-bottom: 10px;
      color: #333;
      font-size: 15px;
    }

    .form-group input[type="text"] {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #eee;
      border-radius: 12px;
      font-size: 16px;
      font-family: inherit;
      transition: border-color 0.2s;
    }

    .form-group input[type="text"]:focus {
      outline: none;
      border-color: #c5171e;
    }

    .level-options {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 350px;
      overflow-y: auto;
    }

    .level-option {
      display: flex;
      align-items: center;
      padding: 12px 14px;
      border: 2px solid #eee;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .level-option:hover {
      border-color: #ffccc0;
      background: #fff9f7;
    }

    .level-option.selected {
      border-color: #c5171e;
      background: #fff5f2;
    }

    .level-option input {
      display: none;
    }

    .level-badge {
      min-width: 55px;
      padding: 4px 8px;
      border-radius: 6px;
      font-weight: 700;
      font-size: 12px;
      text-align: center;
      margin-right: 12px;
      margin-bottom: 4px;
      display: inline-block;
    }

    .level-desc {
      font-size: 13px;
      color: #555;
      line-height: 1.4;
    }

    .level-desc strong {
      display: block;
      color: #333;
      margin-bottom: 2px;
    }

    .start-btn {
      width: 100%;
      padding: 16px;
      background: #c5171e;
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.2s;
      font-family: inherit;
    }

    .start-btn:hover {
      background: #e03e00;
    }

    .start-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    /* ========== ë©”ì¸ ì»¨í…Œì´ë„ˆ ========== */
    #main-container {
      display: none;
    }

    .main-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    /* ìƒë‹¨ ì»¨íŠ¸ë¡¤ */
    .top-controls {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .filter-card {
      background: white;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
      flex: 1;
      min-width: 250px;
    }

    .filter-card h3 {
      font-size: 14px;
      color: #888;
      margin-bottom: 12px;
      font-weight: 600;
    }

    .toggle-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .toggle-label {
      font-size: 15px;
      color: #333;
      font-weight: 500;
    }

    .switch {
      position: relative;
      width: 50px;
      height: 28px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: 0.3s;
      border-radius: 28px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 22px;
      width: 22px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: 0.3s;
      border-radius: 50%;
    }

    input:checked+.slider {
      background-color: #c5171e;
    }

    input:checked+.slider:before {
      transform: translateX(22px);
    }

    /* ë²”ë¡€ */
    .legend {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: #555;
    }

    .legend-dot {
      width: 14px;
      height: 14px;
      border-radius: 50%;
    }

    .legend-dot.safe {
      background: #4CAF50;
    }

    .legend-dot.warning {
      background: #ff9800;
    }

    .legend-dot.danger {
      background: #f44336;
    }

    /* ì§€ë„ ì˜ì—­ */
    .map-section {
      background: white;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
      margin-bottom: 20px;
    }

    .map-section-header {
      padding: 20px 20px 10px 20px;
      border-bottom: 1px solid #eee;
    }

    .map-section h2 {
      padding: 0;
      font-size: 18px;
      border: none;
      margin-bottom: 12px;
    }

    #map {
      width: 100%;
      height: 500px;
    }

    /* ë§›ì§‘ ë¦¬ìŠ¤íŠ¸ */
    .restaurant-section {
      background: white;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
      margin-bottom: 20px;
    }

    .restaurant-section h2 {
      font-size: 18px;
      margin-bottom: 16px;
    }

    .restaurant-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 16px;
    }

    .restaurant-card {
      border: 1px solid #eee;
      border-radius: 12px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .restaurant-card:hover {
      border-color: #c5171e;
      box-shadow: 0 4px 12px rgba(255, 69, 0, 0.15);
    }

    .restaurant-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .restaurant-card h3 {
      font-size: 16px;
      color: #333;
    }

    .restaurant-card .avg-level {
      padding: 4px 10px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 700;
    }

    .restaurant-card .menus {
      font-size: 13px;
      color: #888;
      margin-bottom: 8px;
    }

    .restaurant-card .safety-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .safety-badge.safe {
      background: #e8f5e9;
      color: #2e7d32;
    }

    .safety-badge.warning {
      background: #fff3e0;
      color: #ef6c00;
    }

    .safety-badge.danger {
      background: #ffebee;
      color: #c62828;
    }

    /* í‘¸í„° */
    .footer {
      text-align: center;
      padding: 30px 20px;
      color: #999;
      font-size: 13px;
    }

    .footer a {
      color: #c5171e;
      text-decoration: none;
    }

    .reset-link {
      cursor: pointer;
      text-decoration: underline;
    }

    /* ========== ì¸ì¦ ë²„íŠ¼ ========== */
    .auth-buttons {
      display: flex;
      gap: 10px;
    }

    .auth-btn {
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      font-family: inherit;
      transition: all 0.2s;
    }

    .auth-btn.login {
      background: white;
      color: #c5171e;
      border: 2px solid #c5171e;
    }

    .auth-btn.login:hover {
      background: #fff5f2;
    }

    .auth-btn.signup {
      background: #c5171e;
      color: white;
      border: 2px solid #c5171e;
    }

    .auth-btn.signup:hover {
      background: #e03e00;
    }

    .auth-btn.mypage {
      background: #c5171e;
      color: white;
      border: none;
      padding: 6px 12px;
      font-size: 12px;
    }

    .auth-btn.mypage:hover {
      background: #a01016;
    }

    .auth-btn.logout {
      background: #f5f5f5;
      color: #666;
      border: 1px solid #ddd;
      padding: 6px 12px;
      font-size: 12px;
    }

    .auth-btn.logout:hover {
      background: #eee;
    }

    /* ========== ì¸ì¦ ëª¨ë‹¬ ========== */
    .auth-modal {
      max-width: 400px;
    }

    .auth-tabs {
      display: flex;
      border-bottom: 2px solid #eee;
      margin-bottom: 20px;
    }

    .auth-tab {
      flex: 1;
      padding: 12px;
      border: none;
      background: none;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      color: #888;
      font-family: inherit;
    }

    .auth-tab.active {
      color: #c5171e;
      border-bottom: 2px solid #c5171e;
      margin-bottom: -2px;
    }

    .auth-form-group {
      margin-bottom: 16px;
    }

    .auth-form-group label {
      display: block;
      font-size: 13px;
      color: #666;
      margin-bottom: 6px;
    }

    .auth-form-group input {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
    }

    .auth-form-group input:focus {
      outline: none;
      border-color: #c5171e;
    }

    .auth-submit {
      width: 100%;
      padding: 14px;
      background: #c5171e;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      font-family: inherit;
      margin-top: 10px;
    }

    .auth-submit:hover {
      background: #e03e00;
    }

    .auth-submit:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .auth-error {
      color: #c62828;
      font-size: 13px;
      margin-top: 10px;
      text-align: center;
    }

    /* ========== ëª¨ë‹¬ (íŒì—… ëŒ€ì²´) ========== */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
      overflow-y: auto;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: white;
      border-radius: 20px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }

    .modal-header {
      padding: 20px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      background: white;
      border-radius: 20px 20px 0 0;
    }

    .modal-header h2 {
      font-size: 20px;
      color: #333;
    }

    .modal-close {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      background: #f5f5f5;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-close:hover {
      background: #eee;
    }

    .modal-header-buttons {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .favorite-btn {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      background: #f5f5f5;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .favorite-btn:hover {
      background: #ffe0e0;
      transform: scale(1.1);
    }

    .favorite-btn.active {
      background: #ffe0e0;
      color: #f44336;
    }

    .modal-body {
      padding: 20px;
    }

    .modal-avg-level {
      display: inline-block;
      padding: 6px 14px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .modal-safety {
      display: inline-block;
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      margin-left: 8px;
      margin-bottom: 12px;
    }

    .stats-box {
      background: #fff5f2;
      border-radius: 12px;
      padding: 14px;
      margin-bottom: 20px;
      font-size: 14px;
    }

    .stats-box strong {
      color: #c5171e;
    }

    /* ë¦¬ë·° í¼ */
    .review-form {
      background: #f9f9f9;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 20px;
    }

    .review-form h4 {
      font-size: 15px;
      margin-bottom: 14px;
      color: #333;
    }

    .form-row {
      margin-bottom: 12px;
    }

    .form-row label {
      display: block;
      font-size: 13px;
      color: #666;
      margin-bottom: 6px;
    }

    .form-row select,
    .form-row input[type="text"] {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
    }

    .form-row select:focus,
    .form-row input[type="text"]:focus {
      outline: none;
      border-color: #c5171e;
    }

    /* ì¥ì†Œ ê²€ìƒ‰ ìŠ¤íƒ€ì¼ */
    .search-input-row {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }

    .search-input-row input {
      flex: 1;
    }

    .search-btn {
      padding: 10px 16px;
      background: #c5171e;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
    }

    .search-btn:hover {
      background: #a51015;
    }

    .search-results {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #eee;
      border-radius: 8px;
      margin-bottom: 12px;
      display: none;
    }

    .search-results.active {
      display: block;
    }

    .search-result-item {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      padding: 12px;
      border-bottom: 1px solid #f0f0f0;
      cursor: pointer;
      transition: background 0.2s;
      gap: 12px;
    }

    .search-result-item:last-child {
      border-bottom: none;
    }

    .search-result-item:hover {
      background: #fff5f5;
    }

    .search-result-item .place-info {
      flex: 1;
      min-width: 0;
    }

    .search-result-item .place-name {
      font-weight: 600;
      color: #333;
      margin-bottom: 4px;
    }

    .search-result-item .place-address {
      font-size: 12px;
      color: #888;
      margin-bottom: 4px;
      word-break: break-word;
    }

    .search-result-item .place-category {
      font-size: 11px;
      color: #c5171e;
    }

    .search-result-item .place-distance {
      font-size: 12px;
      color: #666;
      font-weight: 500;
    }

    .search-result-item .select-btn {
      flex-shrink: 0;
      padding: 6px 14px;
      background: #c5171e;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      align-self: flex-end;
    }

    .search-result-item .select-btn:hover {
      background: #a51015;
    }

    .search-no-result {
      padding: 16px;
      text-align: center;
      color: #888;
      font-size: 13px;
    }

    /* ========== ë§ˆì´í˜ì´ì§€ ëª¨ë‹¬ ========== */
    .mypage-modal {
      max-width: 500px;
      max-height: 85vh;
      overflow-y: auto;
    }

    .mypage-header {
      text-align: center;
      padding: 20px 0;
      border-bottom: 1px solid #eee;
      margin-bottom: 20px;
    }

    .mypage-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(135deg, #c5171e 0%, #ff6b35 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 12px;
      font-size: 32px;
    }

    .mypage-nickname {
      font-size: 20px;
      font-weight: 700;
      color: #333;
      margin-bottom: 8px;
    }

    .mypage-stats {
      display: flex;
      justify-content: center;
      gap: 24px;
      margin-top: 12px;
    }

    .mypage-stat {
      text-align: center;
    }

    .mypage-stat-value {
      font-size: 24px;
      font-weight: 700;
      color: #c5171e;
    }

    .mypage-stat-label {
      font-size: 12px;
      color: #888;
      margin-top: 4px;
    }

    .mypage-section {
      margin-top: 20px;
    }

    .mypage-section-title {
      font-size: 16px;
      font-weight: 700;
      color: #333;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 2px solid #c5171e;
    }

    .review-item {
      background: #f9f9f9;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .review-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .review-item-restaurant {
      font-weight: 600;
      color: #333;
    }

    .review-item-status {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
    }

    .review-item-status.pending {
      background: #fff3cd;
      color: #856404;
    }

    .review-item-status.approved {
      background: #d4edda;
      color: #155724;
    }

    .review-item-status.rejected {
      background: #f8d7da;
      color: #721c24;
    }

    .review-item-menu {
      font-size: 14px;
      color: #666;
      margin-bottom: 4px;
    }

    .review-item-level {
      font-size: 13px;
      color: #c5171e;
      font-weight: 500;
    }

    .review-item-date {
      font-size: 11px;
      color: #aaa;
      margin-top: 8px;
    }

    .review-item-reason {
      margin-top: 8px;
      padding: 8px;
      background: #fff;
      border-left: 3px solid #dc3545;
      font-size: 12px;
      color: #666;
    }

    .no-reviews {
      text-align: center;
      padding: 40px 20px;
      color: #888;
    }

    .no-reviews-icon {
      font-size: 48px;
      margin-bottom: 12px;
    }

    /* ========== ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ========== */
    .admin-modal {
      width: 95%;
      max-width: 800px;
      max-height: 90vh;
    }

    .admin-stats {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
    }

    .admin-stat-card {
      flex: 1;
      padding: 16px;
      border-radius: 12px;
      text-align: center;
    }

    .admin-stat-card.pending {
      background: linear-gradient(135deg, #fff3cd, #ffeeba);
      border: 1px solid #ffc107;
    }

    .admin-stat-card.approved {
      background: linear-gradient(135deg, #d4edda, #c3e6cb);
      border: 1px solid #28a745;
    }

    .admin-stat-card.rejected {
      background: linear-gradient(135deg, #f8d7da, #f5c6cb);
      border: 1px solid #dc3545;
    }

    .admin-stat-value {
      font-size: 28px;
      font-weight: bold;
      color: #333;
    }

    .admin-stat-label {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }

    .admin-filter-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      border-bottom: 1px solid #eee;
      padding-bottom: 12px;
    }

    .admin-filter-tab {
      padding: 8px 16px;
      border: none;
      background: #f5f5f5;
      border-radius: 20px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
    }

    .admin-filter-tab:hover {
      background: #e0e0e0;
    }

    .admin-filter-tab.active {
      background: #c5171e;
      color: white;
    }

    .admin-review-list {
      max-height: 400px;
      overflow-y: auto;
    }

    .admin-loading {
      text-align: center;
      padding: 40px;
      color: #888;
    }

    .admin-review-item {
      background: #fff;
      border: 1px solid #eee;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .admin-review-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .admin-review-info h4 {
      margin: 0 0 4px 0;
      font-size: 16px;
      color: #333;
    }

    .admin-review-meta {
      font-size: 12px;
      color: #888;
    }

    .admin-review-status {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
    }

    .admin-review-status.pending {
      background: #fff3cd;
      color: #856404;
    }

    .admin-review-status.approved {
      background: #d4edda;
      color: #155724;
    }

    .admin-review-status.rejected {
      background: #f8d7da;
      color: #721c24;
    }

    .admin-review-content {
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
    }

    .admin-review-images {
      display: flex;
      gap: 8px;
    }

    .admin-review-images img {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 8px;
      cursor: pointer;
    }

    .admin-review-details {
      flex: 1;
    }

    .admin-review-details p {
      margin: 0 0 6px 0;
      font-size: 13px;
      color: #555;
    }

    .admin-review-actions {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
    }

    .admin-review-actions button {
      padding: 8px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-approve {
      background: #28a745;
      color: white;
    }

    .btn-approve:hover {
      background: #218838;
    }

    .btn-reject-action {
      background: #dc3545;
      color: white;
    }

    .btn-reject-action:hover {
      background: #c82333;
    }

    .admin-no-reviews {
      text-align: center;
      padding: 40px;
      color: #888;
    }

    /* ë°˜ë ¤ ì‚¬ìœ  ëª¨ë‹¬ */
    .reject-modal {
      width: 90%;
      max-width: 400px;
    }

    .reject-modal textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      resize: none;
      font-size: 14px;
      margin-bottom: 16px;
    }

    .reject-modal-actions {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
    }

    .btn-cancel {
      padding: 10px 20px;
      border: 1px solid #ddd;
      background: white;
      border-radius: 6px;
      cursor: pointer;
    }

    .btn-reject {
      padding: 10px 20px;
      border: none;
      background: #dc3545;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }

    .btn-reject:hover {
      background: #c82333;
    }

    /* í—¤ë” ê´€ë¦¬ì ë²„íŠ¼ */
    .auth-btn.admin {
      background: #6c757d;
      color: white;
    }

    .auth-btn.admin:hover {
      background: #5a6268;
    }

    .image-upload-row {
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
    }

    .image-upload-box {
      flex: 1;
      text-align: center;
    }

    .image-upload-box label {
      display: block;
      font-size: 12px;
      color: #666;
      margin-bottom: 6px;
    }

    .image-upload-area {
      border: 2px dashed #ddd;
      border-radius: 8px;
      padding: 16px 8px;
      cursor: pointer;
      transition: all 0.2s;
      background: white;
    }

    .image-upload-area:hover {
      border-color: #c5171e;
      background: #fff5f5;
    }

    .image-upload-area.has-image {
      border-color: #4CAF50;
      background: #f0fff0;
    }

    .image-upload-area input[type="file"] {
      display: none;
    }

    .image-upload-area .upload-icon {
      font-size: 24px;
      display: block;
      margin-bottom: 4px;
    }

    .image-upload-area .upload-text {
      font-size: 11px;
      color: #888;
    }

    .image-preview {
      max-width: 100%;
      max-height: 80px;
      border-radius: 6px;
      object-fit: cover;
    }

    .level-buttons {
      display: flex;
      gap: 6px;
    }

    .level-btn {
      flex: 1;
      padding: 12px 8px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background: white;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s;
      font-family: inherit;
    }

    .level-btn:hover {
      border-color: #c5171e;
    }

    .level-btn.selected {
      background: #c5171e;
      color: white;
      border-color: #c5171e;
    }

    .submit-btn {
      width: 100%;
      padding: 14px;
      background: #c5171e;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      font-family: inherit;
    }

    .submit-btn:hover {
      background: #e03e00;
    }

    /* ë§›ì§‘ ìƒì„¸ ëª¨ë‹¬ ê°œì„  */
    .restaurant-header {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 16px;
    }

    /* ì´ë¯¸ì§€ ìºëŸ¬ì…€ */
    .image-carousel {
      position: relative;
      width: 100%;
      height: 200px;
      border-radius: 12px;
      overflow: hidden;
      background: #f5f5f5;
    }

    .carousel-track {
      display: flex;
      transition: transform 0.3s ease;
      height: 100%;
    }

    .carousel-slide {
      min-width: 100%;
      height: 100%;
      position: relative;
    }

    .carousel-slide img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .carousel-slide-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 64px;
      color: white;
    }

    .carousel-slide-placeholder.korean {
      background: linear-gradient(135deg, #ff6b6b 0%, #c5171e 100%);
    }
    .carousel-slide-placeholder.western {
      background: linear-gradient(135deg, #ffa726 0%, #e65100 100%);
    }
    .carousel-slide-placeholder.japanese {
      background: linear-gradient(135deg, #4fc3f7 0%, #0277bd 100%);
    }
    .carousel-slide-placeholder.chinese {
      background: linear-gradient(135deg, #ffeb3b 0%, #f57f17 100%);
    }
    .carousel-slide-placeholder.default {
      background: linear-gradient(135deg, #ff6b6b 0%, #c5171e 100%);
    }

    .carousel-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0,0,0,0.5);
      color: white;
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }

    .carousel-nav:hover {
      background: rgba(0,0,0,0.7);
    }

    .carousel-nav.prev {
      left: 8px;
    }

    .carousel-nav.next {
      right: 8px;
    }

    .carousel-nav:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .carousel-dots {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 6px;
    }

    .carousel-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255,255,255,0.5);
      border: none;
      cursor: pointer;
      padding: 0;
    }

    .carousel-dot.active {
      background: white;
    }

    .carousel-counter {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.5);
      color: white;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
    }

    .restaurant-info-row {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .restaurant-image {
      width: 120px;
      height: 120px;
      border-radius: 12px;
      object-fit: cover;
      flex-shrink: 0;
      background: #f5f5f5;
    }

    .restaurant-image-placeholder {
      width: 120px;
      height: 120px;
      border-radius: 12px;
      background: linear-gradient(135deg, #ff6b6b 0%, #c5171e 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      flex-shrink: 0;
    }

    .restaurant-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .modal-mini-map {
      width: 100%;
      height: 150px;
      border-radius: 12px;
      margin-bottom: 16px;
      background: #eee;
    }

    .write-review-btn {
      width: 100%;
      padding: 14px;
      background: #c5171e;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      font-family: inherit;
      margin-top: 16px;
    }

    .write-review-btn:hover {
      background: #e03e00;
    }

    .write-review-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    /* ë¦¬ë·° ì‘ì„± ëª¨ë‹¬ */
    .review-form-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10002;
    }

    .review-form-overlay.active {
      display: flex;
    }

    .review-form-modal {
      background: white;
      border-radius: 16px;
      width: 90%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      padding: 24px;
    }

    .review-form-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .review-form-header h3 {
      font-size: 18px;
      margin: 0;
    }

    .review-form-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #666;
    }

    /* ë¦¬ë·° ë¦¬ìŠ¤íŠ¸ */
    .review-list h4 {
      font-size: 15px;
      margin-bottom: 14px;
      color: #333;
    }

    .review-item {
      padding: 12px;
      border: 1px solid #eee;
      border-radius: 10px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .review-item:hover {
      border-color: #ddd;
      background: #fafafa;
    }

    .review-item.expanded {
      background: #fff;
      border-color: #c5171e;
    }

    /* ë¯¸ë¦¬ë³´ê¸° ìƒíƒœ */
    .review-preview {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .review-thumb {
      width: 50px;
      height: 50px;
      border-radius: 8px;
      object-fit: cover;
      flex-shrink: 0;
    }

    .review-thumb-placeholder {
      width: 50px;
      height: 50px;
      border-radius: 8px;
      background: #f0f0f0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      flex-shrink: 0;
    }

    .review-preview-info {
      flex: 1;
      min-width: 0;
    }

    .review-preview-top {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 4px;
    }

    .review-preview-text {
      font-size: 13px;
      color: #666;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .review-expand-icon {
      font-size: 12px;
      color: #999;
      transition: transform 0.2s;
    }

    .review-item.expanded .review-expand-icon {
      transform: rotate(180deg);
    }

    /* ìƒì„¸ ë³´ê¸° ìƒíƒœ */
    .review-detail {
      display: none;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid #eee;
    }

    .review-item.expanded .review-detail {
      display: block;
    }

    .review-food-image {
      width: 100%;
      max-height: 250px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 12px;
    }

    .review-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .review-nickname {
      font-weight: 600;
      font-size: 14px;
    }

    .review-user-level {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 4px;
      background: #eee;
    }

    .review-menu {
      font-size: 12px;
      color: #888;
    }

    .review-content {
      font-size: 14px;
      color: #333;
      line-height: 1.6;
      margin-top: 8px;
    }

    .review-level {
      color: #c5171e;
      font-weight: 700;
    }

    .no-review {
      text-align: center;
      color: #999;
      font-size: 14px;
      padding: 30px 0;
    }

    /* ì»¤ìŠ¤í…€ ë§ˆì»¤ */
    .custom-marker {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      color: white;
      font-weight: 700;
      font-size: 16px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
      border: 3px solid white;
    }

    /* í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.3); opacity: 0.7; }
      100% { transform: scale(1); opacity: 1; }
    }

    /* ë‚´ ìœ„ì¹˜ ë²„íŠ¼ */
    .my-location-btn {
      padding: 8px 16px;
      background: #4285F4;
      color: white;
      border: none;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
    }

    .my-location-btn:hover {
      background: #3367D6;
      transform: scale(1.05);
    }

    /* ì œë³´í•˜ê¸° ë²„íŠ¼ */
    .report-btn {
      padding: 8px 16px;
      background: #c5171e;
      color: white;
      border: none;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
    }

    .report-btn:hover {
      background: #a51015;
      transform: scale(1.05);
    }

    /* ë°˜ì‘í˜• */
    @media (max-width: 768px) {
      .header-inner {
        padding: 12px 16px;
      }

      .logo {
        font-size: 0px;
      }

      .main-content {
        padding: 16px;
      }

      .top-controls {
        flex-direction: column;
      }

      #map {
        height: 400px;
      }

      .restaurant-list {
        grid-template-columns: 1fr;
      }

      .legend {
        flex-direction: column;
        gap: 10px;
      }
    }
  </style>
</head>

<body>
  <!-- í—¤ë” -->
  <header class="header">
    <div class="header-inner">
      <div class="logo"><img src="/img/logo.svg" alt="logo" width="40px"></div>
      <div class="user-info" id="header-user-info" style="display: none;">
        <span class="nickname" id="header-nickname" style="cursor: pointer;" onclick="openMyPage()"></span>
        <span class="user-level-badge" id="header-level"></span>
        <button class="auth-btn admin" id="admin-btn" style="display: none;" onclick="openAdminDashboard()">ğŸ›¡ï¸ ê´€ë¦¬ì</button>
        <button class="auth-btn mypage" onclick="openMyPage()">ë§ˆì´í˜ì´ì§€</button>
        <button class="auth-btn logout" onclick="handleLogout()">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
      <div class="auth-buttons" id="auth-buttons">
        <button class="auth-btn login" onclick="openAuthModal('login')">ë¡œê·¸ì¸</button>
        <button class="auth-btn signup" onclick="openAuthModal('signup')">íšŒì›ê°€ì…</button>
      </div>
    </div>
  </header>

  <!-- ì˜¨ë³´ë”© -->
  <div id="onboarding">
    <div class="onboarding-container">
      <div class="onboarding-logo">
        <h1><img src="/img/logo.svg" alt="logo" width="100px"></h1>
        <p>ë§¤ìš´ë§› ì‹¤íŒ¨ ì—†ëŠ” ë§›ì§‘ ì§€ë„</p>
      </div>

      <div class="form-group">
        <label>ë‹‰ë„¤ì„</label>
        <input type="text" id="nickname-input" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" maxlength="10">
      </div>

      <div class="form-group">
        <label>ë‚˜ì˜ ë§µë ˆë²¨ì€?</label>
        <div class="level-options">
          <label class="level-option" data-level="0">
            <input type="radio" name="level" value="0">
            <span class="level-badge level-0">Lv.0</span>
            <span class="level-desc">
              <strong>ì „í˜€ ëª» ë¨¹ëŠ”ë‹¤</strong>
              ì§„ë¼ë©´ ìˆœí•œë§›ë„ ë§¤ì›€
            </span>
          </label>
          <label class="level-option" data-level="1">
            <input type="radio" name="level" value="1">
            <span class="level-badge level-1">Lv.1</span>
            <span class="level-desc">
              <strong>ê±°ì˜ ëª» ë¨¹ëŠ”ë‹¤</strong>
              ì‹ ë¼ë©´ ì •ë„ ê°€ëŠ¥
            </span>
          </label>
          <label class="level-option" data-level="2">
            <input type="radio" name="level" value="2">
            <span class="level-badge level-2">Lv.2 ğŸŒ¶ï¸</span>
            <span class="level-desc">
              <strong>ì˜ ëª» ë¨¹ëŠ” í¸ì´ë‹¤</strong>
              ì—´ë¼ë©´ ì •ë„ ê°€ëŠ¥
            </span>
          </label>
          <label class="level-option" data-level="3">
            <input type="radio" name="level" value="3">
            <span class="level-badge level-3">Lv.3 ğŸŒ¶ï¸ğŸŒ¶ï¸</span>
            <span class="level-desc">
              <strong>ë³´í†µì´ë‹¤</strong>
              ë¶ˆë‹­ë³¶ìŒë©´, ì—½ë–¡ ì˜¤ë¦¬ì§€ë„ ê°€ëŠ¥
            </span>
          </label>
          <label class="level-option" data-level="4">
            <input type="radio" name="level" value="4">
            <span class="level-badge level-4">Lv.4 ğŸ”¥ğŸ”¥</span>
            <span class="level-desc">
              <strong>ì˜ ë¨¹ëŠ” í¸ì´ë‹¤</strong>
              ì—½ë–¡ ë§¤ìš´ë§› ê°€ëŠ¥
            </span>
          </label>
          <label class="level-option" data-level="5">
            <input type="radio" name="level" value="5">
            <span class="level-badge level-5">Lv.5 ğŸ”¥ğŸ”¥ğŸ”¥</span>
            <span class="level-desc">
              <strong>ì•„ì£¼ ì˜ ë¨¹ëŠ”ë‹¤</strong>
              í•µë¶ˆë‹­, ë””ì§„ë‹¤ëˆê¹ŒìŠ¤ ë„ì „ ê°€ëŠ¥
            </span>
          </label>
        </div>
      </div>

      <button class="start-btn" id="start-btn" disabled>ì‹œì‘í•˜ê¸°</button>
    </div>
  </div>

  <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
  <div id="main-container">
    <div class="main-content">
      <!-- ìƒë‹¨ ì»¨íŠ¸ë¡¤ -->
      <div class="top-controls">
        <!-- <div class="filter-card">
          <h3>ğŸ›¡ï¸ ì•ˆì „ í•„í„°</h3>
          <div class="toggle-row">
            <span class="toggle-label">ë‚´ ë ˆë²¨ ì´í•˜ë§Œ ë³´ê¸°</span>
            <label class="switch">
              <input type="checkbox" id="safety-filter">
              <span class="slider"></span>
            </label>
          </div>
        </div> -->

        <div class="filter-card">
          <h3>ğŸ“ ë‚´ ê¸°ì¤€ìœ¼ë¡œ ë‹¤ì‹œ ì“°ëŠ” ë§µë ˆë²¨</h3>
          <div class="legend">
            <div class="legend-item">
              <span class="legend-dot safe"></span>
              <span>Safe - ë§›ìˆê²Œ ë¨¹ì„ ìˆ˜ ìˆì–´ìš”</span>
            </div>
            <div class="legend-item">
              <span class="legend-dot warning"></span>
              <span>Warning - ì¡°ê¸ˆ ë§¤ìš¸ ìˆ˜ ìˆì–´ìš”</span>
            </div>
            <div class="legend-item">
              <span class="legend-dot danger"></span>
              <span>Danger - ë„ì „ì´ í•„ìš”í•´ìš”</span>
            </div>
          </div>
        </div>
      </div>

      <!-- ì§€ë„ -->
      <div class="map-section">
        <div class="map-section-header">
          <h2>ğŸ—ºï¸ ë§¤ìš´ë§›ì§‘ ì§€ë„</h2>
          <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
            <button class="my-location-btn" onclick="moveToMyLocation()">
              ğŸ“ ë‚´ ìœ„ì¹˜ë¡œ
            </button>
            <button class="report-btn" onclick="openReportModal()">
              ğŸ”¥ ë§›ì§‘ ì œë³´í•˜ê¸°
            </button>
            <div class="toggle-row">
              <span class="toggle-label">ë‚´ ë ˆë²¨ ì´í•˜ë§Œ ë³´ê¸°</span>
              <label class="switch">
                <input type="checkbox" id="safety-filter">
                <span class="slider"></span>
              </label>
            </div>
          </div>
        </div>
        <div id="map"></div>
      </div>

      <!-- ë§›ì§‘ ë¦¬ìŠ¤íŠ¸ -->
      <div class="restaurant-section">
        <h2>ğŸœ ë§›ì§‘ ë¦¬ìŠ¤íŠ¸</h2>
        <div class="restaurant-list" id="restaurant-list"></div>
      </div>
    </div>

    <!-- í‘¸í„° -->
    <div class="footer">
      <p>ğŸ”¥ ë§µë§µë§µ - ë§¤ìš´ë§› ì‹¤íŒ¨ ì—†ëŠ” ë§›ì§‘ ì§€ë„</p>
      <p style="margin-top: 8px;">
        <span class="reset-link" onclick="resetData()">ì²˜ìŒë¶€í„° ë‹¤ì‹œí•˜ê¸°</span>
      </p>
    </div>
  </div>

  <!-- ëª¨ë‹¬ -->
  <div class="modal-overlay" id="modal-overlay">
    <div class="modal" id="modal">
      <div class="modal-header">
        <h2 id="modal-title"></h2>
        <div class="modal-header-buttons">
          <button class="favorite-btn" id="favorite-btn" onclick="toggleFavorite()" title="ì°œí•˜ê¸°">ğŸ¤</button>
          <button class="modal-close" onclick="closeModal()">Ã—</button>
        </div>
      </div>
      <div class="modal-body" id="modal-body"></div>
    </div>
  </div>

  <!-- ì¸ì¦ ëª¨ë‹¬ -->
  <div class="modal-overlay" id="auth-modal-overlay">
    <div class="modal auth-modal">
      <div class="modal-header">
        <h2>ğŸ”¥ ë§µë§µë§µ</h2>
        <button class="modal-close" onclick="closeAuthModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="auth-tabs">
          <button class="auth-tab active" id="tab-login" onclick="switchAuthTab('login')">ë¡œê·¸ì¸</button>
          <button class="auth-tab" id="tab-signup" onclick="switchAuthTab('signup')">íšŒì›ê°€ì…</button>
        </div>

        <!-- ë¡œê·¸ì¸ í¼ -->
        <form id="login-form" onsubmit="handleLogin(event)">
          <div class="auth-form-group">
            <label>ì´ë©”ì¼</label>
            <input type="email" id="login-email" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" required>
          </div>
          <div class="auth-form-group">
            <label>ë¹„ë°€ë²ˆí˜¸</label>
            <input type="password" id="login-password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
          </div>
          <button type="submit" class="auth-submit">ë¡œê·¸ì¸</button>
          <div class="auth-error" id="login-error"></div>
        </form>

        <!-- íšŒì›ê°€ì… í¼ -->
        <form id="signup-form" style="display: none;" onsubmit="handleSignup(event)">
          <div class="auth-form-group">
            <label>ì´ë©”ì¼</label>
            <input type="email" id="signup-email" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" required>
          </div>
          <div class="auth-form-group">
            <label>ë¹„ë°€ë²ˆí˜¸</label>
            <input type="password" id="signup-password" placeholder="6ì ì´ìƒ ì…ë ¥í•˜ì„¸ìš”" minlength="6" required>
          </div>
          <div class="auth-form-group">
            <label>ë‹‰ë„¤ì„</label>
            <input type="text" id="signup-nickname" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="20" required>
          </div>
          <button type="submit" class="auth-submit">íšŒì›ê°€ì…</button>
          <div class="auth-error" id="signup-error"></div>
        </form>
      </div>
    </div>
  </div>

  <!-- ì œë³´í•˜ê¸° ëª¨ë‹¬ -->
  <div class="modal-overlay" id="report-modal-overlay">
    <div class="modal auth-modal">
      <div class="modal-header">
        <h2>ğŸ”¥ ë§›ì§‘ ì œë³´í•˜ê¸°</h2>
        <button class="modal-close" onclick="closeReportModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <p style="color: #666; font-size: 13px; margin-bottom: 16px;">
          ìƒˆë¡œìš´ ë§¤ìš´ë§›ì§‘ì„ ë°œê²¬í•˜ì…¨ë‚˜ìš”? ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ë¦¬ë·°ì™€ í•¨ê»˜ ì œë³´í•´ì£¼ì„¸ìš”!
        </p>
        <form id="report-form" onsubmit="submitReport(event)">
          <div class="auth-form-group">
            <label>ğŸ” ê°€ê²Œ ê²€ìƒ‰</label>
            <div class="search-input-row">
              <input type="text" id="report-search" placeholder="ê°€ê²Œ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰í•˜ì„¸ìš”">
              <button type="button" class="search-btn" onclick="searchPlace()">ê²€ìƒ‰</button>
            </div>
            <div class="search-results" id="search-results"></div>
          </div>
          <div class="auth-form-group">
            <label>ê°€ê²Œ ì´ë¦„ *</label>
            <input type="text" id="report-name" placeholder="ê°€ê²Œ ì´ë¦„ì„ ì…ë ¥í•˜ê±°ë‚˜ ìœ„ì—ì„œ ê²€ìƒ‰í•˜ì„¸ìš”" required>
          </div>
          <div class="auth-form-group">
            <label>ì£¼ì†Œ *</label>
            <input type="text" id="report-address" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ì§€ë„ì—ì„œ ì„ íƒí•˜ì„¸ìš”" required readonly>
          </div>
          <div class="auth-form-group">
            <label>ğŸ“ ìœ„ì¹˜ ì„ íƒ *</label>
            <p style="font-size: 11px; color: #888; margin-bottom: 8px;">ì§€ë„ë¥¼ í´ë¦­í•˜ë©´ ì£¼ì†Œê°€ ìë™ìœ¼ë¡œ ì…ë ¥ë©ë‹ˆë‹¤</p>
            <div id="report-map" style="width: 100%; height: 200px; border-radius: 8px; margin-bottom: 8px;"></div>
            <input type="hidden" id="report-lat">
            <input type="hidden" id="report-lng">
            <p id="report-location-text" style="font-size: 12px; color: #4CAF50; display: none;">âœ… ìœ„ì¹˜ê°€ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤</p>
          </div>
          <div class="auth-form-group">
            <label>ë“œì‹  ë©”ë‰´ *</label>
            <input type="text" id="report-menu" placeholder="ë“œì‹  ë©”ë‰´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
          </div>
          <div class="auth-form-group">
            <label>ë§µê¸° í‰ê°€ *</label>
            <div class="level-buttons" id="report-level-buttons">
              <button type="button" class="level-btn" data-level="0" onclick="selectReportLevel(0)">0</button>
              <button type="button" class="level-btn" data-level="1" onclick="selectReportLevel(1)">1</button>
              <button type="button" class="level-btn" data-level="2" onclick="selectReportLevel(2)">2</button>
              <button type="button" class="level-btn" data-level="3" onclick="selectReportLevel(3)">3</button>
              <button type="button" class="level-btn" data-level="4" onclick="selectReportLevel(4)">4</button>
              <button type="button" class="level-btn" data-level="5" onclick="selectReportLevel(5)">5</button>
            </div>
          </div>
          <div class="image-upload-row">
            <div class="image-upload-box">
              <label>ğŸ“· ìŒì‹ ì‚¬ì§„ (í•„ìˆ˜)</label>
              <div class="image-upload-area" id="report-food-area" onclick="document.getElementById('report-food-image').click()">
                <span class="upload-icon">ğŸœ</span>
                <span class="upload-text">í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</span>
                <input type="file" id="report-food-image" accept="image/*" onchange="handleImageUpload(this, 'report-food-area')">
              </div>
            </div>
            <div class="image-upload-box">
              <label>ğŸ§¾ ì˜ìˆ˜ì¦ ì‚¬ì§„ (í•„ìˆ˜)</label>
              <div class="image-upload-area" id="report-receipt-area" onclick="document.getElementById('report-receipt-image').click()">
                <span class="upload-icon">ğŸ§¾</span>
                <span class="upload-text">í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</span>
                <input type="file" id="report-receipt-image" accept="image/*" onchange="handleImageUpload(this, 'report-receipt-area')">
              </div>
            </div>
          </div>
          <div class="auth-form-group">
            <label>í•œì¤„í‰ (ì„ íƒ)</label>
            <input type="text" id="report-comment" placeholder="ë§›ì€ ì–´ë• ë‚˜ìš”?">
          </div>
          <button type="submit" class="auth-submit">ì œë³´í•˜ê¸°</button>
          <div class="auth-error" id="report-error"></div>
        </form>
      </div>
    </div>
  </div>

  <!-- ë§ˆì´í˜ì´ì§€ ëª¨ë‹¬ -->
  <div class="modal-overlay" id="mypage-modal-overlay">
    <div class="modal mypage-modal">
      <div class="modal-header">
        <h2>ğŸ‘¤ ë§ˆì´í˜ì´ì§€</h2>
        <button class="modal-close" onclick="closeMyPage()">Ã—</button>
      </div>
      <div class="modal-body">
        <!-- í”„ë¡œí•„ ì„¹ì…˜ -->
        <div class="mypage-header">
          <div class="mypage-avatar">ğŸ”¥</div>
          <div class="mypage-nickname" id="mypage-nickname"></div>
          <span class="user-level-badge" id="mypage-level"></span>
          <div class="mypage-stats">
            <div class="mypage-stat">
              <div class="mypage-stat-value" id="mypage-points">0</div>
              <div class="mypage-stat-label">ë³´ìœ  í¬ì¸íŠ¸</div>
            </div>
            <div class="mypage-stat">
              <div class="mypage-stat-value" id="mypage-review-count">0</div>
              <div class="mypage-stat-label">ì‘ì„± ë¦¬ë·°</div>
            </div>
          </div>
        </div>

        <!-- ë‚´ ë¦¬ë·° ì„¹ì…˜ -->
        <div class="mypage-section">
          <h3 class="mypage-section-title">ğŸ“ ë‚´ ë¦¬ë·°</h3>
          <div id="mypage-reviews">
            <div class="no-reviews">
              <div class="no-reviews-icon">ğŸ“‹</div>
              <div>ì•„ì§ ì‘ì„±í•œ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ëª¨ë‹¬ -->
  <div class="modal-overlay" id="admin-modal-overlay">
    <div class="modal admin-modal">
      <div class="modal-header">
        <h2>ğŸ›¡ï¸ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h2>
        <button class="modal-close" onclick="closeAdminDashboard()">Ã—</button>
      </div>
      <div class="modal-body">
        <!-- í†µê³„ ì¹´ë“œ -->
        <div class="admin-stats">
          <div class="admin-stat-card pending">
            <div class="admin-stat-value" id="admin-stat-pending">0</div>
            <div class="admin-stat-label">ì‹¬ì‚¬ ëŒ€ê¸°</div>
          </div>
          <div class="admin-stat-card approved">
            <div class="admin-stat-value" id="admin-stat-approved">0</div>
            <div class="admin-stat-label">ìŠ¹ì¸ë¨</div>
          </div>
          <div class="admin-stat-card rejected">
            <div class="admin-stat-value" id="admin-stat-rejected">0</div>
            <div class="admin-stat-label">ë°˜ë ¤ë¨</div>
          </div>
        </div>

        <!-- í•„í„° íƒ­ -->
        <div class="admin-filter-tabs">
          <button class="admin-filter-tab active" onclick="filterAdminReviews('pending')">ëŒ€ê¸°ì¤‘</button>
          <button class="admin-filter-tab" onclick="filterAdminReviews('approved')">ìŠ¹ì¸</button>
          <button class="admin-filter-tab" onclick="filterAdminReviews('rejected')">ë°˜ë ¤</button>
          <button class="admin-filter-tab" onclick="filterAdminReviews('')">ì „ì²´</button>
        </div>

        <!-- ë¦¬ë·° ëª©ë¡ -->
        <div class="admin-review-list" id="admin-review-list">
          <div class="admin-loading">ë¦¬ë·°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ë°˜ë ¤ ì‚¬ìœ  ì…ë ¥ ëª¨ë‹¬ -->
  <div class="modal-overlay" id="reject-modal-overlay">
    <div class="modal reject-modal">
      <div class="modal-header">
        <h2>ë°˜ë ¤ ì‚¬ìœ  ì…ë ¥</h2>
        <button class="modal-close" onclick="closeRejectModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <textarea id="reject-reason" placeholder="ë°˜ë ¤ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”..." rows="4"></textarea>
        <div class="reject-modal-actions">
          <button class="btn-cancel" onclick="closeRejectModal()">ì·¨ì†Œ</button>
          <button class="btn-reject" onclick="confirmReject()">ë°˜ë ¤ í™•ì¸</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ë¦¬ë·° ì‘ì„± ëª¨ë‹¬ -->
  <div class="review-form-overlay" id="review-form-overlay">
    <div class="review-form-modal">
      <div class="review-form-header">
        <h3>âœï¸ ë¦¬ë·° ì‘ì„±</h3>
        <button class="review-form-close" onclick="closeReviewFormModal()">Ã—</button>
      </div>
      <div class="review-form">
        <div class="form-row">
          <label>ë©”ë‰´</label>
          <input type="text" id="modal-menu" placeholder="ë“œì‹  ë©”ë‰´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
        </div>
        <div class="form-row">
          <label>ë§µê¸° í‰ê°€</label>
          <div class="level-buttons" id="modal-level-buttons">
            <button class="level-btn" data-level="0" onclick="selectModalLevel(0)">0</button>
            <button class="level-btn" data-level="1" onclick="selectModalLevel(1)">1</button>
            <button class="level-btn" data-level="2" onclick="selectModalLevel(2)">2</button>
            <button class="level-btn" data-level="3" onclick="selectModalLevel(3)">3</button>
            <button class="level-btn" data-level="4" onclick="selectModalLevel(4)">4</button>
            <button class="level-btn" data-level="5" onclick="selectModalLevel(5)">5</button>
          </div>
        </div>
        <div class="image-upload-row">
          <div class="image-upload-box">
            <label>ğŸ“· ìŒì‹ ì‚¬ì§„ (í•„ìˆ˜)</label>
            <div class="image-upload-area" id="food-image-area" onclick="document.getElementById('modal-food-image').click()">
              <span class="upload-icon">ğŸœ</span>
              <span class="upload-text">í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</span>
              <input type="file" id="modal-food-image" accept="image/*" onchange="handleImageUpload(this, 'food-image-area')">
            </div>
          </div>
          <div class="image-upload-box">
            <label>ğŸ§¾ ì˜ìˆ˜ì¦ ì‚¬ì§„ (í•„ìˆ˜)</label>
            <div class="image-upload-area" id="receipt-image-area" onclick="document.getElementById('modal-receipt-image').click()">
              <span class="upload-icon">ğŸ§¾</span>
              <span class="upload-text">í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</span>
              <input type="file" id="modal-receipt-image" accept="image/*" onchange="handleImageUpload(this, 'receipt-image-area')">
            </div>
          </div>
        </div>
        <div class="form-row">
          <label>í•œì¤„í‰ (ì„ íƒ)</label>
          <input type="text" id="modal-text" placeholder="ë§›ì€ ì–´ë• ë‚˜ìš”?">
        </div>
        <button class="submit-btn" id="review-submit-btn" onclick="submitModalReview()">ë¦¬ë·° ë“±ë¡</button>
      </div>
    </div>
  </div>

  <!-- API Client -->
  <script src="/js/api.js"></script>

  <script>
    // ========== ìƒíƒœ ==========
    let restaurants = [];
    let currentUser = null;
    let map = null;
    let markers = [];
    let selectedLevels = {};
    let userLocationMarker = null;
    let userLocation = null;
    let currentModalRestaurant = null;  // í˜„ì¬ ì—´ë¦° ëª¨ë‹¬ì˜ ë§›ì§‘
    let currentFavoriteStatus = false;  // í˜„ì¬ ë§›ì§‘ ì°œ ìƒíƒœ
    let reportMap = null;  // ì œë³´í•˜ê¸° ëª¨ë‹¬ ì§€ë„
    let reportMarker = null;  // ì œë³´í•˜ê¸° ìœ„ì¹˜ ë§ˆì»¤
    let modalMiniMap = null;  // ë§›ì§‘ ìƒì„¸ ëª¨ë‹¬ ë¯¸ë‹ˆë§µ

    // ========== ì¸ì¦ ëª¨ë‹¬ ==========
    function openAuthModal(tab = 'login') {
      document.getElementById('auth-modal-overlay').classList.add('active');
      document.body.style.overflow = 'hidden';
      switchAuthTab(tab);
    }

    function closeAuthModal() {
      document.getElementById('auth-modal-overlay').classList.remove('active');
      document.body.style.overflow = '';
      // ì—ëŸ¬ ë©”ì‹œì§€ ì´ˆê¸°í™”
      document.getElementById('login-error').textContent = '';
      document.getElementById('signup-error').textContent = '';
    }

    function switchAuthTab(tab) {
      document.getElementById('tab-login').classList.toggle('active', tab === 'login');
      document.getElementById('tab-signup').classList.toggle('active', tab === 'signup');
      document.getElementById('login-form').style.display = tab === 'login' ? 'block' : 'none';
      document.getElementById('signup-form').style.display = tab === 'signup' ? 'block' : 'none';
    }

    document.getElementById('auth-modal-overlay').addEventListener('click', (e) => {
      if (e.target === document.getElementById('auth-modal-overlay')) closeAuthModal();
    });

    // ========== ì œë³´í•˜ê¸° ëª¨ë‹¬ ==========
    function openReportModal() {
      if (!currentUser) {
        showToast('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤', 'error');
        openAuthModal('login');
        return;
      }

      document.getElementById('report-modal-overlay').classList.add('active');
      document.body.style.overflow = 'hidden';

      // í¼ ì´ˆê¸°í™”
      document.getElementById('report-form').reset();
      document.getElementById('report-lat').value = '';
      document.getElementById('report-lng').value = '';
      document.getElementById('report-location-text').style.display = 'none';
      document.getElementById('report-error').textContent = '';
      selectedLevels.report = undefined;
      document.querySelectorAll('#report-level-buttons .level-btn').forEach(btn => {
        btn.classList.remove('selected');
      });

      // ì´ë¯¸ì§€ ì—…ë¡œë“œ ì˜ì—­ ì´ˆê¸°í™”
      const foodArea = document.getElementById('report-food-area');
      foodArea.innerHTML = '<span class="upload-icon">ğŸœ</span><span class="upload-text">í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</span><input type="file" id="report-food-image" accept="image/*" onchange="handleImageUpload(this, \'report-food-area\')">';
      foodArea.classList.remove('has-image');

      const receiptArea = document.getElementById('report-receipt-area');
      receiptArea.innerHTML = '<span class="upload-icon">ğŸ§¾</span><span class="upload-text">í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</span><input type="file" id="report-receipt-image" accept="image/*" onchange="handleImageUpload(this, \'report-receipt-area\')">';
      receiptArea.classList.remove('has-image');

      // ì§€ë„ ì´ˆê¸°í™” (ì•½ê°„ì˜ ì§€ì—° í›„)
      setTimeout(() => {
        initReportMap();
      }, 100);
    }

    // ì—­ì§€ì˜¤ì½”ë”©ì„ ìœ„í•œ Geocoder
    let reportGeocoder = null;

    function initReportMap() {
      const mapContainer = document.getElementById('report-map');

      // í˜„ì¬ ìœ„ì¹˜ ë˜ëŠ” ê¸°ë³¸ ìœ„ì¹˜ ì‚¬ìš©
      const centerLat = userLocation ? userLocation.lat : 37.5665;
      const centerLng = userLocation ? userLocation.lng : 126.9780;

      const options = {
        center: new kakao.maps.LatLng(centerLat, centerLng),
        level: 4
      };

      reportMap = new kakao.maps.Map(mapContainer, options);

      // Geocoder ì´ˆê¸°í™” (ì—­ì§€ì˜¤ì½”ë”©ìš©)
      reportGeocoder = new kakao.maps.services.Geocoder();

      // ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸
      kakao.maps.event.addListener(reportMap, 'click', function(mouseEvent) {
        const latlng = mouseEvent.latLng;

        // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
        if (reportMarker) {
          reportMarker.setMap(null);
        }

        // ìƒˆ ë§ˆì»¤ ìƒì„±
        reportMarker = new kakao.maps.Marker({
          position: latlng,
          map: reportMap
        });

        // ì¢Œí‘œ ì €ì¥
        document.getElementById('report-lat').value = latlng.getLat();
        document.getElementById('report-lng').value = latlng.getLng();
        document.getElementById('report-location-text').style.display = 'block';

        // ì—­ì§€ì˜¤ì½”ë”©: ì¢Œí‘œ â†’ ì£¼ì†Œ
        reportGeocoder.coord2Address(latlng.getLng(), latlng.getLat(), function(result, status) {
          if (status === kakao.maps.services.Status.OK) {
            // ë„ë¡œëª… ì£¼ì†Œ ìš°ì„ , ì—†ìœ¼ë©´ ì§€ë²ˆ ì£¼ì†Œ
            const address = result[0].road_address
              ? result[0].road_address.address_name
              : result[0].address.address_name;
            document.getElementById('report-address').value = address;
          }
        });
      });
    }

    // ì¥ì†Œ ê²€ìƒ‰ ê¸°ëŠ¥
    let placesService = null;

    function searchPlace() {
      const keyword = document.getElementById('report-search').value.trim();
      const resultsContainer = document.getElementById('search-results');

      if (!keyword) {
        showToast('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
        return;
      }

      // Places ì„œë¹„ìŠ¤ ì´ˆê¸°í™”
      if (!placesService) {
        placesService = new kakao.maps.services.Places();
      }

      // ê²€ìƒ‰ ì˜µì…˜: í˜„ì¬ ìœ„ì¹˜ ê¸°ì¤€ ê±°ë¦¬ìˆœ ì •ë ¬
      const searchOptions = {};
      if (userLocation) {
        searchOptions.location = new kakao.maps.LatLng(userLocation.lat, userLocation.lng);
        searchOptions.sort = kakao.maps.services.SortBy.DISTANCE;
      }

      // í‚¤ì›Œë“œë¡œ ì¥ì†Œ ê²€ìƒ‰ (í˜„ì¬ ìœ„ì¹˜ ê¸°ì¤€ ê±°ë¦¬ìˆœ)
      placesService.keywordSearch(keyword, function(result, status) {
        if (status === kakao.maps.services.Status.OK) {
          displaySearchResults(result);
        } else if (status === kakao.maps.services.Status.ZERO_RESULT) {
          resultsContainer.innerHTML = '<div class="empty-result">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
          resultsContainer.classList.add('active');
        } else {
          showToast('ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
        }
      }, searchOptions);
    }

    function displaySearchResults(places) {
      const resultsContainer = document.getElementById('search-results');
      resultsContainer.innerHTML = '';

      places.slice(0, 10).forEach(place => {
        const item = document.createElement('div');
        item.className = 'search-result-item';

        // ê±°ë¦¬ í¬ë§·íŒ… (m â†’ km)
        let distanceText = '';
        if (place.distance) {
          const dist = parseInt(place.distance);
          distanceText = dist >= 1000
            ? `<span class="place-distance">ğŸ“ ${(dist / 1000).toFixed(1)}km</span>`
            : `<span class="place-distance">ğŸ“ ${dist}m</span>`;
        }

        item.innerHTML = `
          <div class="place-info">
            <span class="place-name">${place.place_name}</span>
            <span class="place-address">${place.road_address_name || place.address_name}</span>
            ${distanceText}
            ${place.category_name ? `<span class="place-category">${place.category_name}</span>` : ''}
          </div>
          <button type="button" class="select-btn" onclick="selectSearchResult('${place.place_name.replace(/'/g, "\\'")}', '${(place.road_address_name || place.address_name).replace(/'/g, "\\'")}', ${place.y}, ${place.x})">ì„ íƒ</button>
        `;
        resultsContainer.appendChild(item);
      });

      resultsContainer.classList.add('active');
    }

    function selectSearchResult(name, address, lat, lng) {
      // í¼ì— ì •ë³´ ì±„ìš°ê¸°
      document.getElementById('report-name').value = name;
      document.getElementById('report-address').value = address;
      document.getElementById('report-lat').value = lat;
      document.getElementById('report-lng').value = lng;

      // ê²€ìƒ‰ ê²°ê³¼ ë‹«ê¸°
      document.getElementById('search-results').classList.remove('active');
      document.getElementById('report-search').value = '';

      // ì§€ë„ì— ë§ˆì»¤ í‘œì‹œ
      if (reportMap) {
        const position = new kakao.maps.LatLng(lat, lng);

        // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
        if (reportMarker) {
          reportMarker.setMap(null);
        }

        // ìƒˆ ë§ˆì»¤ ìƒì„±
        reportMarker = new kakao.maps.Marker({
          position: position,
          map: reportMap
        });

        // ì§€ë„ ì¤‘ì‹¬ ì´ë™
        reportMap.setCenter(position);
        document.getElementById('report-location-text').style.display = 'block';
      }

      showToast(`'${name}' ì •ë³´ê°€ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤`, 'success');
    }

    function closeReportModal() {
      document.getElementById('report-modal-overlay').classList.remove('active');
      document.body.style.overflow = '';

      // ë§ˆì»¤ ì •ë¦¬
      if (reportMarker) {
        reportMarker.setMap(null);
        reportMarker = null;
      }

      // ê²€ìƒ‰ ê²°ê³¼ ì´ˆê¸°í™”
      document.getElementById('search-results').classList.remove('active');
      document.getElementById('search-results').innerHTML = '';
    }

    document.getElementById('report-modal-overlay').addEventListener('click', (e) => {
      if (e.target === document.getElementById('report-modal-overlay')) closeReportModal();
    });

    // ê²€ìƒ‰ ì…ë ¥ì°½ Enter í‚¤ ì§€ì›
    document.getElementById('report-search').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        searchPlace();
      }
    });

    function selectReportLevel(level) {
      selectedLevels.report = level;
      document.querySelectorAll('#report-level-buttons .level-btn').forEach(btn => {
        btn.classList.toggle('selected', parseInt(btn.dataset.level) === level);
      });
    }

    async function submitReport(event) {
      event.preventDefault();

      const name = document.getElementById('report-name').value.trim();
      const address = document.getElementById('report-address').value.trim();
      const lat = document.getElementById('report-lat').value;
      const lng = document.getElementById('report-lng').value;
      const menu = document.getElementById('report-menu').value.trim();
      const level = selectedLevels.report;
      const comment = document.getElementById('report-comment').value.trim();
      const foodImage = document.getElementById('report-food-image').files[0];
      const receiptImage = document.getElementById('report-receipt-image').files[0];
      const errorEl = document.getElementById('report-error');

      // ìœ íš¨ì„± ê²€ì‚¬
      if (!name) { errorEl.textContent = 'ê°€ê²Œ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'; return; }
      if (!address) { errorEl.textContent = 'ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”'; return; }
      if (!lat || !lng) { errorEl.textContent = 'ì§€ë„ì—ì„œ ìœ„ì¹˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”'; return; }
      if (!menu) { errorEl.textContent = 'ë©”ë‰´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”'; return; }
      if (level === undefined) { errorEl.textContent = 'ë§µê¸° ë ˆë²¨ì„ ì„ íƒí•´ì£¼ì„¸ìš”'; return; }
      if (!foodImage) { errorEl.textContent = 'ìŒì‹ ì‚¬ì§„ì„ ì²¨ë¶€í•´ì£¼ì„¸ìš”'; return; }
      if (!receiptImage) { errorEl.textContent = 'ì˜ìˆ˜ì¦ ì‚¬ì§„ì„ ì²¨ë¶€í•´ì£¼ì„¸ìš”'; return; }

      errorEl.textContent = '';

      try {
        // 1. ë§›ì§‘ ë“±ë¡
        const restaurantResult = await API.restaurants.create({
          name,
          address,
          lat: parseFloat(lat),
          lng: parseFloat(lng),
          category: 'ë§¤ìš´ë§›'
        });

        // 2. ë¦¬ë·° ë“±ë¡
        const formData = new FormData();
        formData.append('restaurant_id', restaurantResult.restaurant.id);
        formData.append('menu_name', menu);
        formData.append('spicy_level', level);
        formData.append('comment', comment);
        formData.append('food_image', foodImage);
        formData.append('receipt_image', receiptImage);

        await API.reviews.create(formData);

        showToast('ì œë³´í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ê´€ë¦¬ì ìŠ¹ì¸ í›„ ë°˜ì˜ë©ë‹ˆë‹¤. ğŸ”¥', 'success');
        closeReportModal();

        // ë§›ì§‘ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        await loadRestaurants();
      } catch (error) {
        errorEl.textContent = error.message || 'ì œë³´ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤';
      }
    }

    async function handleLogin(e) {
      e.preventDefault();
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      const errorEl = document.getElementById('login-error');

      try {
        const result = await API.auth.login(email, password);
        currentUser = result.user;
        AppState.setUser(currentUser);
        closeAuthModal();

        // ë§µë ˆë²¨ ì„¤ì • í•„ìš” ì—¬ë¶€ í™•ì¸
        if (currentUser.spicy_level === null || currentUser.spicy_level === undefined) {
          showOnboarding();
        } else {
          showMain();
        }
        showToast('ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
      } catch (error) {
        errorEl.textContent = error.message;
      }
    }

    async function handleSignup(e) {
      e.preventDefault();
      const email = document.getElementById('signup-email').value;
      const password = document.getElementById('signup-password').value;
      const nickname = document.getElementById('signup-nickname').value;
      const errorEl = document.getElementById('signup-error');

      try {
        const result = await API.auth.signup(email, password, nickname);
        currentUser = result.user;
        AppState.setUser(currentUser);
        closeAuthModal();
        showOnboarding(); // ì‹ ê·œ ê°€ì…ìëŠ” ë§µë ˆë²¨ ì„¤ì • í•„ìš”
        showToast('íšŒì›ê°€ì… ì™„ë£Œ! ë§µë ˆë²¨ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.', 'success');
      } catch (error) {
        errorEl.textContent = error.message;
      }
    }

    async function handleLogout() {
      try {
        await API.auth.logout();
        currentUser = null;
        AppState.setUser(null);
        location.reload();
      } catch (error) {
        showToast('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨', 'error');
      }
    }

    // ========== ë§ˆì´í˜ì´ì§€ ==========
    async function openMyPage() {
      if (!currentUser) {
        showToast('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤', 'error');
        return;
      }

      const modal = document.getElementById('mypage-modal-overlay');
      modal.classList.add('active');

      // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
      document.getElementById('mypage-nickname').textContent = currentUser.nickname;
      document.getElementById('mypage-level').textContent = `Lv.${currentUser.spicy_level}`;
      document.getElementById('mypage-level').className = `user-level-badge level-${currentUser.spicy_level}`;
      document.getElementById('mypage-points').textContent = currentUser.points || 0;

      // ë‚´ ë¦¬ë·° ëª©ë¡ ë¡œë“œ
      try {
        const response = await API.reviews.myList();
        renderMyReviews(response.reviews || []);
      } catch (error) {
        console.error('Failed to load reviews:', error);
        document.getElementById('mypage-reviews').innerHTML = `
          <div class="no-reviews">
            <div class="no-reviews-icon">âŒ</div>
            <div>ë¦¬ë·°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>
          </div>
        `;
      }
    }

    function closeMyPage() {
      document.getElementById('mypage-modal-overlay').classList.remove('active');
    }

    function renderMyReviews(reviews) {
      const container = document.getElementById('mypage-reviews');
      const reviewCount = document.getElementById('mypage-review-count');

      reviewCount.textContent = reviews.length;

      if (reviews.length === 0) {
        container.innerHTML = `
          <div class="no-reviews">
            <div class="no-reviews-icon">ğŸ“‹</div>
            <div>ì•„ì§ ì‘ì„±í•œ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤</div>
          </div>
        `;
        return;
      }

      container.innerHTML = reviews.map(review => {
        const statusText = {
          'pending': 'ì‹¬ì‚¬ì¤‘',
          'approved': 'ìŠ¹ì¸',
          'rejected': 'ë°˜ë ¤'
        }[review.status] || review.status;

        const statusClass = review.status;
        const date = new Date(review.created_at).toLocaleDateString('ko-KR');

        let reasonHtml = '';
        if (review.status === 'rejected' && review.reject_reason) {
          reasonHtml = `<div class="review-item-reason">ë°˜ë ¤ ì‚¬ìœ : ${review.reject_reason}</div>`;
        }

        return `
          <div class="review-item">
            <div class="review-item-header">
              <span class="review-item-restaurant">${review.restaurant_name || 'ì•Œ ìˆ˜ ì—†ëŠ” ë§›ì§‘'}</span>
              <span class="review-item-status ${statusClass}">${statusText}</span>
            </div>
            <div class="review-item-menu">${review.menu_name} Â· ë§µê¸° Lv.${review.spicy_level}</div>
            <div class="review-item-date">${date}</div>
            ${reasonHtml}
          </div>
        `;
      }).join('');
    }

    // ë§ˆì´í˜ì´ì§€ ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    document.getElementById('mypage-modal-overlay')?.addEventListener('click', (e) => {
      if (e.target.id === 'mypage-modal-overlay') {
        closeMyPage();
      }
    });

    // ========== ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ==========
    let adminReviews = [];
    let currentAdminFilter = 'pending';
    let rejectingReviewId = null;

    async function openAdminDashboard() {
      if (!currentUser || !currentUser.is_admin) {
        showToast('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤', 'error');
        return;
      }

      document.getElementById('admin-modal-overlay').classList.add('active');
      await loadAdminReviews('pending');
    }

    function closeAdminDashboard() {
      document.getElementById('admin-modal-overlay').classList.remove('active');
    }

    async function loadAdminReviews(status = '') {
      currentAdminFilter = status;
      const listContainer = document.getElementById('admin-review-list');
      listContainer.innerHTML = '<div class="admin-loading">ë¦¬ë·°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';

      try {
        const response = await API.admin.getReviews(status);
        adminReviews = response.reviews || [];

        // í†µê³„ ì—…ë°ì´íŠ¸
        if (response.stats) {
          document.getElementById('admin-stat-pending').textContent = response.stats.pending || 0;
          document.getElementById('admin-stat-approved').textContent = response.stats.approved || 0;
          document.getElementById('admin-stat-rejected').textContent = response.stats.rejected || 0;
        }

        renderAdminReviews(adminReviews);
      } catch (error) {
        console.error('Admin reviews load error:', error);
        listContainer.innerHTML = '<div class="admin-no-reviews">ë¦¬ë·°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>';
      }
    }

    function filterAdminReviews(status) {
      // íƒ­ í™œì„±í™” ìƒíƒœ ë³€ê²½
      document.querySelectorAll('.admin-filter-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      event.target.classList.add('active');

      loadAdminReviews(status);
    }

    function renderAdminReviews(reviews) {
      const container = document.getElementById('admin-review-list');

      if (reviews.length === 0) {
        container.innerHTML = '<div class="admin-no-reviews">í•´ë‹¹í•˜ëŠ” ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
        return;
      }

      container.innerHTML = reviews.map(review => {
        const statusText = {
          'pending': 'ì‹¬ì‚¬ì¤‘',
          'approved': 'ìŠ¹ì¸',
          'rejected': 'ë°˜ë ¤'
        }[review.status];

        const date = new Date(review.created_at).toLocaleDateString('ko-KR');

        const actionsHtml = review.status === 'pending' ? `
          <div class="admin-review-actions">
            <button class="btn-approve" onclick="approveReview('${review.id}')">âœ“ ìŠ¹ì¸</button>
            <button class="btn-reject-action" onclick="openRejectModal('${review.id}')">âœ• ë°˜ë ¤</button>
          </div>
        ` : '';

        const rejectReasonHtml = review.status === 'rejected' && review.reject_reason ? `
          <p style="color: #dc3545;"><strong>ë°˜ë ¤ ì‚¬ìœ :</strong> ${review.reject_reason}</p>
        ` : '';

        return `
          <div class="admin-review-item">
            <div class="admin-review-header">
              <div class="admin-review-info">
                <h4>${review.restaurant_name || 'ì•Œ ìˆ˜ ì—†ëŠ” ë§›ì§‘'}</h4>
                <div class="admin-review-meta">
                  ${review.user_nickname} (${review.user_email}) Â· ${date}
                </div>
              </div>
              <span class="admin-review-status ${review.status}">${statusText}</span>
            </div>
            <div class="admin-review-content">
              <div class="admin-review-images">
                <img src="${review.food_image_url}" alt="ìŒì‹ ì‚¬ì§„" onclick="window.open('${review.food_image_url}', '_blank')">
                <img src="${review.receipt_image_url}" alt="ì˜ìˆ˜ì¦" onclick="window.open('${review.receipt_image_url}', '_blank')">
              </div>
              <div class="admin-review-details">
                <p><strong>ë©”ë‰´:</strong> ${review.menu_name}</p>
                <p><strong>ë§µê¸° ë ˆë²¨:</strong> Lv.${review.spicy_level}</p>
                ${review.comment ? `<p><strong>ì½”ë©˜íŠ¸:</strong> ${review.comment}</p>` : ''}
                ${rejectReasonHtml}
              </div>
            </div>
            ${actionsHtml}
          </div>
        `;
      }).join('');
    }

    async function approveReview(reviewId) {
      if (!confirm('ì´ ë¦¬ë·°ë¥¼ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì‚¬ìš©ìì—ê²Œ 500P ì ë¦½)')) return;

      try {
        const response = await API.admin.approve(reviewId);
        showToast(response.message || 'ìŠ¹ì¸ ì™„ë£Œ', 'success');
        await loadAdminReviews(currentAdminFilter);
      } catch (error) {
        showToast(error.message || 'ìŠ¹ì¸ ì‹¤íŒ¨', 'error');
      }
    }

    function openRejectModal(reviewId) {
      rejectingReviewId = reviewId;
      document.getElementById('reject-reason').value = '';
      document.getElementById('reject-modal-overlay').classList.add('active');
    }

    function closeRejectModal() {
      rejectingReviewId = null;
      document.getElementById('reject-modal-overlay').classList.remove('active');
    }

    async function confirmReject() {
      const reason = document.getElementById('reject-reason').value.trim();
      if (!reason) {
        showToast('ë°˜ë ¤ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
        return;
      }

      try {
        const response = await API.admin.reject(rejectingReviewId, reason);
        showToast(response.message || 'ë°˜ë ¤ ì™„ë£Œ', 'success');
        closeRejectModal();
        await loadAdminReviews(currentAdminFilter);
      } catch (error) {
        showToast(error.message || 'ë°˜ë ¤ ì‹¤íŒ¨', 'error');
      }
    }

    // ê´€ë¦¬ì ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    document.getElementById('admin-modal-overlay')?.addEventListener('click', (e) => {
      if (e.target.id === 'admin-modal-overlay') {
        closeAdminDashboard();
      }
    });

    document.getElementById('reject-modal-overlay')?.addEventListener('click', (e) => {
      if (e.target.id === 'reject-modal-overlay') {
        closeRejectModal();
      }
    });

    function resetData() {
      if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        handleLogout();
      }
    }

    // ========== ì˜¨ë³´ë”© (ë§µë ˆë²¨ ì„¤ì •) ==========
    function showOnboarding() {
      document.getElementById('onboarding').style.display = 'flex';
      document.getElementById('main-container').style.display = 'none';
      initOnboarding();
    }

    function initOnboarding() {
      const nicknameInput = document.getElementById('nickname-input');
      const levelOptions = document.querySelectorAll('.level-option');
      const startBtn = document.getElementById('start-btn');

      // ì´ë¯¸ ë¡œê·¸ì¸ëœ ê²½ìš° ë‹‰ë„¤ì„ ìë™ ì…ë ¥
      if (currentUser) {
        nicknameInput.value = currentUser.nickname;
        nicknameInput.disabled = true;
      }

      let selectedLevel = null;

      levelOptions.forEach(option => {
        option.addEventListener('click', () => {
          levelOptions.forEach(o => o.classList.remove('selected'));
          option.classList.add('selected');
          option.querySelector('input').checked = true;
          selectedLevel = parseInt(option.dataset.level);
          checkFormValid();
        });
      });

      nicknameInput.addEventListener('input', checkFormValid);

      function checkFormValid() {
        const nickname = nicknameInput.value.trim();
        startBtn.disabled = !(nickname.length > 0 && selectedLevel !== null);
      }

      startBtn.onclick = async () => {
        try {
          if (!currentUser) {
            // ë¹„ë¡œê·¸ì¸ ìƒíƒœë©´ íšŒì›ê°€ì… ëª¨ë‹¬ ì—´ê¸°
            openAuthModal('signup');
            return;
          }

          // ë§µë ˆë²¨ ì €ì¥
          await API.auth.setSpicyLevel(selectedLevel);
          currentUser.spicy_level = selectedLevel;
          AppState.setUser(currentUser);
          showToast(`Lv.${selectedLevel} ë§µë¶€ì‹¬ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
          showMain();
        } catch (error) {
          showToast(error.message, 'error');
        }
      };
    }

    // ========== ë©”ì¸ í™”ë©´ ==========
    async function showMain() {
      document.getElementById('onboarding').style.display = 'none';
      document.getElementById('main-container').style.display = 'block';

      // í—¤ë” ìœ ì € ì •ë³´
      AppState.setUser(currentUser);

      // ë§›ì§‘ ë°ì´í„° ë¡œë“œ
      try {
        const result = await API.restaurants.list();
        restaurants = result.restaurants || [];
        AppState.restaurants = restaurants;
      } catch (error) {
        console.error('ë§›ì§‘ ë¡œë“œ ì‹¤íŒ¨:', error);
        restaurants = [];
      }

      initMap();
      renderRestaurantList();

      document.getElementById('safety-filter').addEventListener('change', () => {
        updateMarkers();
        renderRestaurantList();
      });
    }

    // ========== ì§€ë„ (ì¹´ì¹´ì˜¤ë§µ) ==========
    function initMap(centerLat = 37.54, centerLng = 126.98) {
      const container = document.getElementById('map');
      const options = {
        center: new kakao.maps.LatLng(centerLat, centerLng),
        level: 5
      };
      map = new kakao.maps.Map(container, options);

      // ì§€ë„ ì»¨íŠ¸ë¡¤ ì¶”ê°€
      const zoomControl = new kakao.maps.ZoomControl();
      map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

      // í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
      getUserLocation();

      updateMarkers();
    }

    // ì‚¬ìš©ì í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
    function getUserLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            userLocation = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };

            // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ í‘œì‹œ
            showUserLocationMarker();

            // ë¡œê·¸ì¸ ìƒíƒœë©´ ë‚´ ìœ„ì¹˜ë¡œ ì´ë™
            if (currentUser) {
              const moveLatLng = new kakao.maps.LatLng(userLocation.lat, userLocation.lng);
              map.setCenter(moveLatLng);
            }
          },
          (error) => {
            console.log('ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', error.message);
          },
          { enableHighAccuracy: true, timeout: 10000 }
        );
      }
    }

    // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ í‘œì‹œ
    function showUserLocationMarker() {
      if (!userLocation || !map) return;

      // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
      if (userLocationMarker) {
        userLocationMarker.setMap(null);
      }

      // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ ìƒì„±
      const markerContent = `
        <div style="
          width: 20px;
          height: 20px;
          background: #4285F4;
          border: 3px solid white;
          border-radius: 50%;
          box-shadow: 0 2px 6px rgba(0,0,0,0.3);
          animation: pulse 2s infinite;
        "></div>
      `;

      const customOverlay = new kakao.maps.CustomOverlay({
        position: new kakao.maps.LatLng(userLocation.lat, userLocation.lng),
        content: markerContent,
        yAnchor: 0.5,
        xAnchor: 0.5
      });
      customOverlay.setMap(map);
      userLocationMarker = customOverlay;
    }

    // ë‚´ ìœ„ì¹˜ë¡œ ì´ë™ ë²„íŠ¼
    function moveToMyLocation() {
      if (userLocation && map) {
        const moveLatLng = new kakao.maps.LatLng(userLocation.lat, userLocation.lng);
        map.setCenter(moveLatLng);
        map.setLevel(4);
        showToast('í˜„ì¬ ìœ„ì¹˜ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤', 'success');
      } else {
        getUserLocation();
        showToast('ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...', 'info');
      }
    }

    function updateMarkers() {
      const safetyFilter = document.getElementById('safety-filter').checked;
      const userLevel = currentUser?.spicy_level ?? 3;

      // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
      markers.forEach(m => m.setMap(null));
      markers = [];

      restaurants.forEach(restaurant => {
        const avgLevel = Math.round(restaurant.avg_level) || 0;
        const status = getStatus(avgLevel);
        const isHidden = safetyFilter && avgLevel > userLevel;

        if (isHidden) return;

        let color;
        if (status === 'safe') color = '#4CAF50';
        else if (status === 'warning') color = '#ff9800';
        else color = '#f44336';

        // ì»¤ìŠ¤í…€ ì˜¤ë²„ë ˆì´ë¡œ ë§ˆì»¤ ìƒì„±
        const markerContent = `
          <div class="custom-marker" style="background: ${color}; cursor: pointer;"
               onclick="openRestaurantModal('${restaurant.id}')"
               title="${restaurant.name} (í‰ê·  Lv.${avgLevel})">
            ${avgLevel}
          </div>
        `;

        const customOverlay = new kakao.maps.CustomOverlay({
          position: new kakao.maps.LatLng(restaurant.lat, restaurant.lng),
          content: markerContent,
          yAnchor: 1.2
        });

        customOverlay.setMap(map);
        markers.push(customOverlay);
      });
    }

    function getStatus(avgLevel) {
      const userLevel = currentUser?.spicy_level ?? 3;
      if (avgLevel <= userLevel) return 'safe';
      if (avgLevel === userLevel + 1) return 'warning';
      return 'danger';
    }

    // ========== ë§›ì§‘ ë¦¬ìŠ¤íŠ¸ ==========
    function renderRestaurantList() {
      const safetyFilter = document.getElementById('safety-filter').checked;
      const listEl = document.getElementById('restaurant-list');
      const userLevel = currentUser?.spicy_level ?? 3;

      const filteredRestaurants = safetyFilter
        ? restaurants.filter(r => Math.round(r.avg_level) <= userLevel)
        : restaurants;

      if (filteredRestaurants.length === 0) {
        listEl.innerHTML = '<div class="no-review">ë§›ì§‘ì´ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ë§›ì§‘ì„ ë“±ë¡í•´ë³´ì„¸ìš”!</div>';
        return;
      }

      listEl.innerHTML = filteredRestaurants.map(r => {
        const avgLevel = Math.round(r.avg_level) || 0;
        const status = getStatus(avgLevel);
        let statusText, statusClass;
        if (status === 'safe') { statusText = 'âœ… Safe'; statusClass = 'safe'; }
        else if (status === 'warning') { statusText = 'âš ï¸ Warning'; statusClass = 'warning'; }
        else { statusText = 'ğŸ”¥ Danger'; statusClass = 'danger'; }

        return `
          <div class="restaurant-card" onclick="openRestaurantModal('${r.id}')">
            <div class="restaurant-card-header">
              <h3>${r.name}</h3>
              <span class="avg-level level-${avgLevel}">í‰ê·  Lv.${avgLevel}</span>
            </div>
            <div class="menus">${r.category || ''}</div>
            <span class="safety-badge ${statusClass}">${statusText}</span>
          </div>
        `;
      }).join('');
    }

    function openRestaurantModal(restaurantId) {
      const restaurant = restaurants.find(r => r.id === restaurantId);
      if (restaurant) openModal(restaurant);
    }

    // ========== ëª¨ë‹¬ ==========
    async function openModal(restaurant) {
      currentModalRestaurant = restaurant;  // í˜„ì¬ ë§›ì§‘ ì €ì¥
      const avgLevel = Math.round(restaurant.avg_level) || 0;
      const status = getStatus(avgLevel);
      const userLevel = currentUser?.spicy_level ?? 3;

      // ì°œ ìƒíƒœ í™•ì¸ ë° ë²„íŠ¼ ì—…ë°ì´íŠ¸
      const favoriteBtn = document.getElementById('favorite-btn');
      if (currentUser) {
        try {
          const result = await API.favorites.check(restaurant.id);
          currentFavoriteStatus = result.isFavorite;
          favoriteBtn.textContent = currentFavoriteStatus ? 'â¤ï¸' : 'ğŸ¤';
          favoriteBtn.classList.toggle('active', currentFavoriteStatus);
          favoriteBtn.style.display = 'flex';
        } catch (error) {
          favoriteBtn.style.display = 'none';
        }
      } else {
        favoriteBtn.style.display = 'none';
      }

      let statusText, statusClass;
      if (status === 'safe') { statusText = 'âœ… Safe - ë§›ìˆê²Œ ë¨¹ì„ ìˆ˜ ìˆì–´ìš”'; statusClass = 'safe'; }
      else if (status === 'warning') { statusText = 'âš ï¸ Warning - ì¡°ê¸ˆ ë§¤ìš¸ ìˆ˜ ìˆì–´ìš”'; statusClass = 'warning'; }
      else { statusText = 'ğŸ”¥ Danger - ë„ì „ì´ í•„ìš”í•´ìš”!'; statusClass = 'danger'; }

      // ë§›ì§‘ ìƒì„¸ ì •ë³´ ë¡œë“œ (ë¦¬ë·° í¬í•¨)
      let restaurantDetail = restaurant;
      let restaurantReviews = [];
      try {
        const result = await API.restaurants.get(restaurant.id);
        restaurantDetail = result.restaurant;
        restaurantReviews = result.reviews || [];
      } catch (error) {
        console.error('ë§›ì§‘ ìƒì„¸ ë¡œë“œ ì‹¤íŒ¨:', error);
      }

      const stats = calculateStats(restaurantReviews, userLevel);

      // ì¹´í…Œê³ ë¦¬ë³„ ê¸°ë³¸ ì´ë¯¸ì§€ ì„¤ì •
      const categoryConfig = getCategoryConfig(restaurant.category);

      // ë¦¬ë·° ì´ë¯¸ì§€ë“¤ ìˆ˜ì§‘
      const reviewImages = restaurantReviews
        .filter(r => r.food_image_url)
        .map(r => r.food_image_url);

      // ìºëŸ¬ì…€ ìŠ¬ë¼ì´ë“œ ìƒì„± (ì¹´í…Œê³ ë¦¬ ê¸°ë³¸ + ë¦¬ë·° ì‚¬ì§„ë“¤)
      const carouselSlides = buildCarouselSlides(categoryConfig, reviewImages);
      const totalSlides = 1 + reviewImages.length;  // ì¹´í…Œê³ ë¦¬ ê¸°ë³¸ 1ê°œ + ë¦¬ë·° ì´ë¯¸ì§€ë“¤

      document.getElementById('modal-title').textContent = restaurant.name;
      document.getElementById('modal-body').innerHTML = `
        <div class="restaurant-header">
          <div class="image-carousel" data-current="0" data-total="${totalSlides}">
            <div class="carousel-track">
              ${carouselSlides}
            </div>
            ${totalSlides > 1 ? `
              <button class="carousel-nav prev" onclick="moveCarousel(-1)">â€¹</button>
              <button class="carousel-nav next" onclick="moveCarousel(1)">â€º</button>
              <div class="carousel-counter">1 / ${totalSlides}</div>
              <div class="carousel-dots">
                ${Array.from({length: totalSlides}, (_, i) =>
                  `<button class="carousel-dot ${i === 0 ? 'active' : ''}" onclick="goToSlide(${i})"></button>`
                ).join('')}
              </div>
            ` : ''}
          </div>
          <div class="restaurant-info-row">
            <div class="restaurant-info">
              <span class="modal-avg-level level-${avgLevel}">í‰ê·  Lv.${avgLevel}</span>
              <span class="modal-safety safety-badge ${statusClass}">${statusText}</span>
              <p style="margin: 8px 0 0 0; color: #666; font-size: 13px;">ğŸ“ ${restaurant.address || ''}</p>
            </div>
          </div>
        </div>

        <div id="modal-mini-map" class="modal-mini-map"></div>

        ${stats.hasStats ? `
        <div class="stats-box">
          ğŸ“Š ${stats.isSameLevelStats
            ? `<strong>Lv.${userLevel} ì‚¬ìš©ì ${stats.sameLevel}ëª…</strong> ì¤‘ <strong>${stats.percentage}%</strong>ê°€ Lv.${stats.mostCommonLevel}ë¡œ í‰ê°€í–ˆì–´ìš”`
            : `<strong>ì „ì²´ ë¦¬ë·°ì–´ ${stats.targetCount}ëª…</strong> ì¤‘ <strong>${stats.percentage}%</strong>ê°€ Lv.${stats.mostCommonLevel}ë¡œ í‰ê°€í–ˆì–´ìš”`
          }
        </div>
        ` : ''}

        <div class="review-list">
          <h4>ğŸ’¬ ë¦¬ë·° (${restaurantReviews.length})</h4>
          ${restaurantReviews.length > 0 ?
            restaurantReviews.map((r, idx) => `
              <div class="review-item" onclick="toggleReviewDetail(this)">
                <div class="review-preview">
                  ${r.food_image_url
                    ? `<img src="${r.food_image_url}" class="review-thumb" alt="ìŒì‹">`
                    : `<div class="review-thumb-placeholder">ğŸœ</div>`
                  }
                  <div class="review-preview-info">
                    <div class="review-preview-top">
                      <span class="review-nickname">${r.user_nickname || 'ìµëª…'}</span>
                      <span class="review-user-level">Lv.${r.user_level ?? '?'}</span>
                      <span class="review-level" style="margin-left: auto;">í‰ê°€ Lv.${r.spicy_level}</span>
                    </div>
                    <div class="review-preview-text">${r.menu_name || ''} ${r.comment ? '- ' + r.comment : ''}</div>
                  </div>
                  <span class="review-expand-icon">â–¼</span>
                </div>
                <div class="review-detail">
                  ${r.food_image_url ? `<img src="${r.food_image_url}" class="review-food-image" alt="ìŒì‹ ì‚¬ì§„">` : ''}
                  <div class="review-meta">
                    <span class="review-nickname">${r.user_nickname || 'ìµëª…'}</span>
                    <span class="review-user-level">Lv.${r.user_level ?? '?'}</span>
                    <span class="review-menu">| ${r.menu_name || ''}</span>
                  </div>
                  <div class="review-content">
                    <span class="review-level">[ë§µê¸° í‰ê°€: Lv.${r.spicy_level}]</span>
                    <p style="margin-top: 8px;">${r.comment || 'ì½”ë©˜íŠ¸ ì—†ìŒ'}</p>
                  </div>
                </div>
              </div>
            `).join('')
          : '<div class="no-review">ì•„ì§ ë¦¬ë·°ê°€ ì—†ì–´ìš”. ì²« ë¦¬ë·°ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”!</div>'
          }
        </div>

        ${currentUser
          ? `<button class="write-review-btn" onclick="openReviewFormModal()">âœï¸ ë¦¬ë·°í•˜ê¸°</button>`
          : `<button class="write-review-btn" onclick="openAuthModal('login'); closeModal();" style="background: #888;">ë¡œê·¸ì¸í•˜ê³  ë¦¬ë·° ì‘ì„±í•˜ê¸°</button>`
        }
      `;

      selectedLevels.modal = undefined;
      document.getElementById('modal-overlay').classList.add('active');
      document.body.style.overflow = 'hidden';

      // ë¯¸ë‹ˆë§µ ì´ˆê¸°í™”
      setTimeout(() => {
        const miniMapContainer = document.getElementById('modal-mini-map');
        if (miniMapContainer && restaurant.lat && restaurant.lng) {
          modalMiniMap = new kakao.maps.Map(miniMapContainer, {
            center: new kakao.maps.LatLng(restaurant.lat, restaurant.lng),
            level: 3,
            draggable: false,
            scrollwheel: false,
            disableDoubleClickZoom: true
          });

          // ë§ˆì»¤ ì¶”ê°€
          new kakao.maps.Marker({
            position: new kakao.maps.LatLng(restaurant.lat, restaurant.lng),
            map: modalMiniMap
          });
        }
      }, 100);
    }

    function closeModal() {
      document.getElementById('modal-overlay').classList.remove('active');
      document.body.style.overflow = '';
      currentModalRestaurant = null;
    }

    // ì°œí•˜ê¸° í† ê¸€
    async function toggleFavorite() {
      if (!currentUser) {
        showToast('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤', 'error');
        return;
      }
      if (!currentModalRestaurant) return;

      const favoriteBtn = document.getElementById('favorite-btn');
      try {
        if (currentFavoriteStatus) {
          await API.favorites.remove(currentModalRestaurant.id);
          currentFavoriteStatus = false;
          favoriteBtn.textContent = 'ğŸ¤';
          favoriteBtn.classList.remove('active');
          showToast('ì°œ ëª©ë¡ì—ì„œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤', 'info');
        } else {
          await API.favorites.add(currentModalRestaurant.id);
          currentFavoriteStatus = true;
          favoriteBtn.textContent = 'â¤ï¸';
          favoriteBtn.classList.add('active');
          showToast('ì°œ ëª©ë¡ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        }
      } catch (error) {
        showToast(error.message || 'ì°œí•˜ê¸° ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
      }
    }

    document.getElementById('modal-overlay').addEventListener('click', (e) => {
      if (e.target === document.getElementById('modal-overlay')) closeModal();
    });

    // ========== ë¦¬ë·° ì‘ì„± ëª¨ë‹¬ ==========
    function openReviewFormModal() {
      if (!currentModalRestaurant) return;

      // í¼ ì´ˆê¸°í™”
      document.getElementById('modal-menu').value = '';
      document.getElementById('modal-text').value = '';
      selectedLevels.modal = undefined;

      // ë ˆë²¨ ë²„íŠ¼ ì´ˆê¸°í™”
      document.querySelectorAll('#modal-level-buttons .level-btn').forEach(btn => {
        btn.classList.remove('selected');
      });

      // ì´ë¯¸ì§€ ì—…ë¡œë“œ ì˜ì—­ ì´ˆê¸°í™”
      ['food-image-area', 'receipt-image-area'].forEach(areaId => {
        const area = document.getElementById(areaId);
        if (area) {
          const preview = area.querySelector('.image-preview');
          if (preview) preview.remove();
          const icon = area.querySelector('.upload-icon');
          const text = area.querySelector('.upload-text');
          if (icon) icon.style.display = '';
          if (text) text.style.display = '';
          area.classList.remove('has-image');
          const input = area.querySelector('input[type="file"]');
          if (input) input.value = '';
        }
      });

      document.getElementById('review-form-overlay').classList.add('active');
    }

    function closeReviewFormModal() {
      document.getElementById('review-form-overlay').classList.remove('active');
    }

    document.getElementById('review-form-overlay').addEventListener('click', (e) => {
      if (e.target.id === 'review-form-overlay') closeReviewFormModal();
    });

    function selectModalLevel(level) {
      selectedLevels.modal = level;
      document.querySelectorAll('#modal-level-buttons .level-btn').forEach(btn => {
        btn.classList.toggle('selected', parseInt(btn.dataset.level) === level);
      });
    }

    // ë¦¬ë·° ìƒì„¸ í† ê¸€
    function toggleReviewDetail(element) {
      // ë‹¤ë¥¸ ì—´ë¦° ë¦¬ë·° ë‹«ê¸°
      document.querySelectorAll('.review-item.expanded').forEach(item => {
        if (item !== element) {
          item.classList.remove('expanded');
        }
      });
      // í˜„ì¬ ë¦¬ë·° í† ê¸€
      element.classList.toggle('expanded');
    }

    // ========== ì´ë¯¸ì§€ ìºëŸ¬ì…€ ==========
    // ì¹´í…Œê³ ë¦¬ë³„ ì„¤ì • ë°˜í™˜
    function getCategoryConfig(category) {
      const cat = (category || '').toLowerCase();
      if (cat.includes('í•œì‹') || cat.includes('korean')) {
        return { emoji: 'ğŸš', className: 'korean', label: 'í•œì‹' };
      }
      if (cat.includes('ì–‘ì‹') || cat.includes('western') || cat.includes('ì´íƒˆë¦¬') || cat.includes('í”„ë‘ìŠ¤')) {
        return { emoji: 'ğŸ', className: 'western', label: 'ì–‘ì‹' };
      }
      if (cat.includes('ì¼ì‹') || cat.includes('japanese') || cat.includes('ì´ˆë°¥') || cat.includes('ë¼ë©˜')) {
        return { emoji: 'ğŸ£', className: 'japanese', label: 'ì¼ì‹' };
      }
      if (cat.includes('ì¤‘ì‹') || cat.includes('chinese') || cat.includes('ì¤‘í™”')) {
        return { emoji: 'ğŸ¥¢', className: 'chinese', label: 'ì¤‘ì‹' };
      }
      // ê¸°íƒ€ ì¹´í…Œê³ ë¦¬
      return { emoji: 'ğŸœ', className: 'default', label: category || 'ë§›ì§‘' };
    }

    // ìºëŸ¬ì…€ ìŠ¬ë¼ì´ë“œ HTML ìƒì„±
    function buildCarouselSlides(categoryConfig, reviewImages) {
      const slides = [];

      // ì²« ë²ˆì§¸ ìŠ¬ë¼ì´ë“œ: ì¹´í…Œê³ ë¦¬ ê¸°ë³¸ ì´ë¯¸ì§€
      slides.push(`
        <div class="carousel-slide">
          <div class="carousel-slide-placeholder ${categoryConfig.className}">
            <span>${categoryConfig.emoji}</span>
          </div>
        </div>
      `);

      // ë¦¬ë·° ì´ë¯¸ì§€ë“¤
      reviewImages.forEach(imgUrl => {
        slides.push(`
          <div class="carousel-slide">
            <img src="${imgUrl}" alt="ìŒì‹ ì‚¬ì§„">
          </div>
        `);
      });

      return slides.join('');
    }

    // ìºëŸ¬ì…€ ì´ë™
    function moveCarousel(direction) {
      const carousel = document.querySelector('.image-carousel');
      if (!carousel) return;

      const track = carousel.querySelector('.carousel-track');
      const total = parseInt(carousel.dataset.total);
      let current = parseInt(carousel.dataset.current);

      current += direction;
      if (current < 0) current = 0;
      if (current >= total) current = total - 1;

      updateCarouselPosition(carousel, track, current, total);
    }

    // íŠ¹ì • ìŠ¬ë¼ì´ë“œë¡œ ì´ë™
    function goToSlide(index) {
      const carousel = document.querySelector('.image-carousel');
      if (!carousel) return;

      const track = carousel.querySelector('.carousel-track');
      const total = parseInt(carousel.dataset.total);

      if (index >= 0 && index < total) {
        updateCarouselPosition(carousel, track, index, total);
      }
    }

    // ìºëŸ¬ì…€ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
    function updateCarouselPosition(carousel, track, current, total) {
      carousel.dataset.current = current;
      track.style.transform = `translateX(-${current * 100}%)`;

      // ì¹´ìš´í„° ì—…ë°ì´íŠ¸
      const counter = carousel.querySelector('.carousel-counter');
      if (counter) {
        counter.textContent = `${current + 1} / ${total}`;
      }

      // ë„íŠ¸ ì—…ë°ì´íŠ¸
      carousel.querySelectorAll('.carousel-dot').forEach((dot, i) => {
        dot.classList.toggle('active', i === current);
      });

      // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
      const prevBtn = carousel.querySelector('.carousel-nav.prev');
      const nextBtn = carousel.querySelector('.carousel-nav.next');
      if (prevBtn) prevBtn.disabled = current === 0;
      if (nextBtn) nextBtn.disabled = current === total - 1;
    }

    // í„°ì¹˜ ìŠ¤ì™€ì´í”„ ì§€ì›
    let touchStartX = 0;
    let touchEndX = 0;

    document.addEventListener('touchstart', (e) => {
      if (e.target.closest('.image-carousel')) {
        touchStartX = e.changedTouches[0].screenX;
      }
    }, false);

    document.addEventListener('touchend', (e) => {
      if (e.target.closest('.image-carousel')) {
        touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
      }
    }, false);

    function handleSwipe() {
      const diff = touchStartX - touchEndX;
      if (Math.abs(diff) > 50) {  // 50px ì´ìƒ ìŠ¤ì™€ì´í”„
        if (diff > 0) {
          moveCarousel(1);  // ì™¼ìª½ ìŠ¤ì™€ì´í”„ -> ë‹¤ìŒ
        } else {
          moveCarousel(-1);  // ì˜¤ë¥¸ìª½ ìŠ¤ì™€ì´í”„ -> ì´ì „
        }
      }
    }

    // ì´ë¯¸ì§€ ì—…ë¡œë“œ ë¯¸ë¦¬ë³´ê¸° í•¸ë“¤ëŸ¬
    function handleImageUpload(input, areaId) {
      const area = document.getElementById(areaId);
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          // ê¸°ì¡´ í”„ë¦¬ë·° ì´ë¯¸ì§€ ì œê±°
          const existingPreview = area.querySelector('.image-preview');
          if (existingPreview) {
            existingPreview.remove();
          }
          // ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ ìˆ¨ê¸°ê¸°
          const icon = area.querySelector('.upload-icon');
          const text = area.querySelector('.upload-text');
          if (icon) icon.style.display = 'none';
          if (text) text.style.display = 'none';
          // í”„ë¦¬ë·° ì´ë¯¸ì§€ ì¶”ê°€ (inputì€ ìœ ì§€)
          const img = document.createElement('img');
          img.src = e.target.result;
          img.className = 'image-preview';
          area.insertBefore(img, input);
          area.classList.add('has-image');
        };
        reader.readAsDataURL(input.files[0]);
      }
    }

    async function submitModalReview() {
      if (!currentModalRestaurant) {
        showToast('ë§›ì§‘ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
        return;
      }

      const menu = document.getElementById('modal-menu').value.trim();
      const level = selectedLevels.modal;
      const text = document.getElementById('modal-text').value.trim();
      const foodImage = document.getElementById('modal-food-image').files[0];
      const receiptImage = document.getElementById('modal-receipt-image').files[0];

      if (!menu) { showToast('ë©”ë‰´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'error'); return; }
      if (level === undefined) { showToast('ë§µê¸° ë ˆë²¨ì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'error'); return; }
      if (!foodImage) { showToast('ìŒì‹ ì‚¬ì§„ì„ ì²¨ë¶€í•´ì£¼ì„¸ìš”!', 'error'); return; }
      if (!receiptImage) { showToast('ì˜ìˆ˜ì¦ ì‚¬ì§„ì„ ì²¨ë¶€í•´ì£¼ì„¸ìš”!', 'error'); return; }

      try {
        const formData = new FormData();
        formData.append('restaurant_id', currentModalRestaurant.id);
        formData.append('menu_name', menu);
        formData.append('spicy_level', level);
        formData.append('comment', text);
        formData.append('food_image', foodImage);
        formData.append('receipt_image', receiptImage);

        await API.reviews.create(formData);
        showToast('ë¦¬ë·°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! ê´€ë¦¬ì ìŠ¹ì¸ í›„ ë°˜ì˜ë©ë‹ˆë‹¤. ğŸ”¥', 'success');

        // ë¦¬ë·° í¼ ëª¨ë‹¬ ë‹«ê¸°
        closeReviewFormModal();

        // ë§›ì§‘ ëª¨ë‹¬ ìƒˆë¡œê³ ì¹¨
        openModal(currentModalRestaurant);
      } catch (error) {
        showToast(error.message, 'error');
      }
    }

    function calculateStats(restaurantReviews, userLevel) {
      // APIì—ì„œ ì´ë¯¸ ìŠ¹ì¸ëœ ë¦¬ë·°ë§Œ ë°˜í™˜í•¨
      const total = restaurantReviews.length;

      if (total === 0) return { total: 0, hasStats: false };

      // ê°™ì€ ë ˆë²¨ ì‚¬ìš©ì ë¦¬ë·°
      const sameLevelReviews = restaurantReviews.filter(r => r.user_level === userLevel);
      const sameLevel = sameLevelReviews.length;

      let targetReviews, isSameLevelStats;

      if (sameLevel > 0) {
        targetReviews = sameLevelReviews;
        isSameLevelStats = true;
      } else {
        targetReviews = restaurantReviews;
        isSameLevelStats = false;
      }

      // ê°€ì¥ ë§ì´ í‰ê°€ëœ ë ˆë²¨ ì°¾ê¸°
      const levelCounts = {};
      targetReviews.forEach(r => {
        levelCounts[r.spicy_level] = (levelCounts[r.spicy_level] || 0) + 1;
      });

      let mostCommonLevel = 0;
      let maxCount = 0;
      for (const [level, count] of Object.entries(levelCounts)) {
        if (count > maxCount) {
          maxCount = count;
          mostCommonLevel = parseInt(level);
        }
      }

      const percentage = Math.round((maxCount / targetReviews.length) * 100);

      return {
        total,
        sameLevel,
        percentage,
        isSameLevelStats,
        mostCommonLevel,
        targetCount: targetReviews.length,
        hasStats: true
      };
    }

    // ========== ì´ˆê¸°í™” ==========
    document.addEventListener('DOMContentLoaded', async () => {
      // ì„¸ì…˜ ì²´í¬
      try {
        const result = await API.auth.me();
        if (result.user) {
          currentUser = result.user;
          AppState.setUser(currentUser);

          // ë§µë ˆë²¨ ì„¤ì • ì—¬ë¶€ í™•ì¸
          if (currentUser.spicy_level === null || currentUser.spicy_level === undefined) {
            showOnboarding();
          } else {
            showMain();
          }
        } else {
          // ë¹„ë¡œê·¸ì¸ ìƒíƒœ - ì˜¨ë³´ë”© í™”ë©´ í‘œì‹œ
          document.getElementById('onboarding').style.display = 'flex';
          initOnboarding();
        }
      } catch (error) {
        // ë¹„ë¡œê·¸ì¸ ìƒíƒœ - ì˜¨ë³´ë”© í™”ë©´ í‘œì‹œ
        document.getElementById('onboarding').style.display = 'flex';
        initOnboarding();
      }
    });
  </script>
</body>

</html>